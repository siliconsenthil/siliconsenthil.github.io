<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Apache Camel | siliconsenthil.in]]></title>
  <link href="http://siliconsenthil.herokuapp.com/blog/categories/apache-camel/atom.xml" rel="self"/>
  <link href="http://siliconsenthil.herokuapp.com/"/>
  <updated>2013-07-07T17:53:45+05:30</updated>
  <id>http://siliconsenthil.herokuapp.com/</id>
  <author>
    <name><![CDATA[Senthil V S]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Apache Camel with Scala: Testing Styles]]></title>
    <link href="http://siliconsenthil.herokuapp.com/blog/2013/07/07/apache-camel-with-scala-testing-styles/"/>
    <updated>2013-07-07T15:39:00+05:30</updated>
    <id>http://siliconsenthil.herokuapp.com/blog/2013/07/07/apache-camel-with-scala-testing-styles</id>
    <content type="html"><![CDATA[<p>Scala with Camel is a very powerful combination for integration. Camel has fantastic support for
<a href="http://camel.apache.org/testing.html" target="_blank">testing</a>. It's very easy and useful to test-drive the integration. Following are few styles when it comes to testing camel with scala.</p>

<!-- more -->


<h3>Use CamelTestSupport, JUnit style</h3>

<p>CamelTestSupport already has JUnit annotations to run do setup and teardown in JUnit test suite. The simplest way to get started is to use this with ScalaTest. ScalaTest already has JUnitSuite trait to have JUnit style tests. This is documented <a href="http://www.kai-waehner.de/blog/2011/06/23/apache-camel-and-scala-a-powerful-combination/" target="_blank">here</a>(see Testing section).</p>

<h3>Extending CamelTestSupport</h3>

<p>If you dont like the JUnit style and wanna follow any other styles ScalaTest supports, you can create a base test support class that looks like below.</p>

<p>``` scala</p>

<p>class CustomCamelFlatTestSupport extends CamelTestSupport with BeforeAndAfterAll with FlatSpec{</p>

<p>  override def beforeAll() {</p>

<pre><code>setUp()
</code></pre>

<p>  }</p>

<p>  override def afterAll() {</p>

<pre><code>tearDown()
</code></pre>

<p>  }
}
```</p>

<p>We are following <i>FlatSpec</i> style of ScalaTest.</p>

<p>``` scala
class YourRouteSpec extends CustomCamelFlatTestSupport{
  override def createRouteBuilder = YourRouteBuilder.buildRoute</p>

<p>  before {</p>

<pre><code>interceptTimer()
</code></pre>

<p>  }</p>

<p>  private def interceptTimer() {</p>

<pre><code>context.getRouteDefinition("YourRouteName").adviceWith(context, new AdviceWithRouteBuilder {
  def configure() {
    replaceFromWith("direct:testEndpoint")
  }
})
</code></pre>

<p>  }</p>

<p>  "Your Route" should "do something useful" in {</p>

<pre><code>template.sendBody("direct:testEndpoint", "Some body")
//Assert some behaviour
}
</code></pre>

<p>}
```</p>

<p>We override the <code>createRouteBuilder</code> with the route we wanna test. There might be needs to intercept routes for testing purpose.</p>

<p>But, if wanna have different routes or different interceptors in every test, this style would not suite.</p>

<h3>CamelTestHelper trait</h3>

<p>With this style you can pass differnt builders and different interceptors and the test code is a block that get the test support.</p>

<p>Create a trait like below</p>

<p>``` scala
trait CamelTestHelper{
  def withCamelTestSupport(routeBuilder: RouteBuilder, interceptor:(ModelCamelContext => Unit) = identity(_))(testWithCamelSupport: CamelTestSupport => Any){</p>

<pre><code>new CamelTestSupport{
  override def createRegistry = {
    val registry = super.createRegistry
    //Put entries to registry if needed.
    registry
  }
  override def createRouteBuilder() = routeBuilder
  setUp()
  interceptor(context)
  testWithCamelSupport(this)
  tearDown()
}
</code></pre>

<p>  }
}
```</p>

<p>A typical way to use the trait in test would be,</p>

<p>``` scala
  "Your Route" should "do something useful" in {</p>

<pre><code>val directEndpoint = "direct:testEndpoint"

val testRouteBuilder = new RouteBuilder {
  from("timer:doesNotMatter").routeId("OurRoute").to("file:/some/path"))
}.builder

def interceptor(context: ModelCamelContext) {
  context.getRouteDefinition("OurRoute").adviceWith(context, new AdviceWithRouteBuilder {
    def configure() {
      replaceFromWith(directEndpoint)
    }
  })
}

withCamelTestSupport(testRouteBuilder, interceptor){ testSupport =&gt;
    testSupport.template.sendBody(directEndpoint, "Some content")
    //Assert files exists @ /some/path
  }
}
</code></pre>

<p>  }
```</p>

<p>With this style we get full flexibility about testing routes.</p>
]]></content>
  </entry>
  
</feed>

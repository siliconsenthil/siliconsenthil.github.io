<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#f1efe1 lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Apache Camel with Scala: Testing Styles - siliconsenthil</title><meta name=theme-color><meta name=description content="Scala with Camel is a very powerful combination for integration. Camel has fantastic support for testing. It&rsquo;s very easy and useful to test-drive the integration. Following are few styles when it comes to testing camel with scala.
Use CamelTestSupport, JUnit style CamelTestSupport already has JUnit annotations to run do setup and teardown in JUnit test suite. The simplest way to get started is to use this with ScalaTest. ScalaTest already has JUnitSuite trait to have JUnit style tests."><meta name=author content><link rel="preload stylesheet" as=style href=http://siliconsenthil.in/main.min.css><script defer src=http://siliconsenthil.in/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=http://siliconsenthil.in/theme.png><link rel=preload as=image href=https://www.gravatar.com/avatar/b78415ec052d8811a4f31c4746cbde9f><link rel=preload as=image href=http://siliconsenthil.in/twitter.svg><link rel=preload as=image href=http://siliconsenthil.in/github.svg><link rel=preload as=image href=http://siliconsenthil.in/rss.svg><link rel=icon href=http://siliconsenthil.in/favicon.ico><link rel=apple-touch-icon href=http://siliconsenthil.in/apple-touch-icon.png><meta name=generator content="Hugo 0.101.0"><meta property="og:title" content="Apache Camel with Scala: Testing Styles"><meta property="og:description" content="Testing styles for camel with scala"><meta property="og:type" content="article"><meta property="og:url" content="http://siliconsenthil.in/blog/2013-07-07-apache-camel-with-scala-testing-styles/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2013-07-07T15:39:00+05:30"><meta property="article:modified_time" content="2013-07-07T15:39:00+05:30"><meta itemprop=name content="Apache Camel with Scala: Testing Styles"><meta itemprop=description content="Testing styles for camel with scala"><meta itemprop=datePublished content="2013-07-07T15:39:00+05:30"><meta itemprop=dateModified content="2013-07-07T15:39:00+05:30"><meta itemprop=wordCount content="367"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Apache Camel with Scala: Testing Styles"><meta name=twitter:description content="Testing styles for camel with scala"></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=http://siliconsenthil.in/>siliconsenthil</a>
<a class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"></a></div><a class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"></a>
<script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg=`"#f1efe1"`.replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark");setDark(darkVal?darkVal==="true":darkScheme.matches),darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"><a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./twitter.svg) href=https://twitter.com/siliconsenthil target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/siliconsenthil target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./rss.svg) href=http://siliconsenthil.in/index.xml target=_blank></a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"><article><header class=mb-20><h1 class="!my-0 pb-2.5">Apache Camel with Scala: Testing Styles</h1><div class="text-sm opacity-60"><time>Jul 7, 2013</time></div></header><section><p>Scala with Camel is a very powerful combination for integration. Camel has fantastic support for
<a href=http://camel.apache.org/testing.html target=_blank>testing</a>. It&rsquo;s very easy and useful to test-drive the integration. Following are few styles when it comes to testing camel with scala.</p><h3 id=use-cameltestsupport-junit-style>Use CamelTestSupport, JUnit style</h3><p>CamelTestSupport already has JUnit annotations to run do setup and teardown in JUnit test suite. The simplest way to get started is to use this with ScalaTest. ScalaTest already has JUnitSuite trait to have JUnit style tests. This is documented <a href=http://www.kai-waehner.de/blog/2011/06/23/apache-camel-and-scala-a-powerful-combination/ target=_blank>here</a>(see Testing section).</p><h3 id=extending-cameltestsupport>Extending CamelTestSupport</h3><p>If you dont like the JUnit style and wanna follow any other styles ScalaTest supports, you can create a base test support class that looks like below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomCamelFlatTestSupport</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>CamelTestSupport</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>BeforeAndAfterAll</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>FlatSpec</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> beforeAll<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    setUp<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> afterAll<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    tearDown<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>We are following <i>FlatSpec</i> style of ScalaTest.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>YourRouteSpec</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>CustomCamelFlatTestSupport</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> createRouteBuilder <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>YourRouteBuilder</span><span style=color:#f92672>.</span>buildRoute
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  before <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    interceptTimer<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>def</span> interceptTimer<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>getRouteDefinition<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;YourRouteName&#34;</span><span style=color:#f92672>).</span>adviceWith<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AdviceWithRouteBuilder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>def</span> configure<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        replaceFromWith<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;direct:testEndpoint&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;Your Route&#34;</span> should <span style=color:#e6db74>&#34;do something useful&#34;</span> in <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    template<span style=color:#f92672>.</span>sendBody<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;direct:testEndpoint&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Some body&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//Assert some behaviour
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>We override the <code>createRouteBuilder</code> with the route we wanna test. There might be needs to intercept routes for testing purpose.</p><p>But, if wanna have different routes or different interceptors in every test, this style would not suite.</p><h3 id=cameltesthelper-trait>CamelTestHelper trait</h3><p>With this style you can pass differnt builders and different interceptors and the test code is a block that get the test support.</p><p>Create a trait like below</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>CamelTestHelper</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> withCamelTestSupport<span style=color:#f92672>(</span>routeBuilder<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>RouteBuilder</span><span style=color:#f92672>,</span> interceptor<span style=color:#66d9ef>:</span><span style=color:#f92672>(</span><span style=color:#66d9ef>ModelCamelContext</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>Unit</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> identity<span style=color:#f92672>(</span><span style=color:#66d9ef>_</span><span style=color:#f92672>))(</span>testWithCamelSupport<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>CamelTestSupport</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Any</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CamelTestSupport</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> createRegistry <span style=color:#66d9ef>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> registry <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span>createRegistry
</span></span><span style=display:flex><span>        <span style=color:#75715e>//Put entries to registry if needed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        registry
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> createRouteBuilder<span style=color:#f92672>()</span> <span style=color:#66d9ef>=</span> routeBuilder
</span></span><span style=display:flex><span>      setUp<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>      interceptor<span style=color:#f92672>(</span>context<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      testWithCamelSupport<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      tearDown<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>A typical way to use the trait in test would be,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span>  <span style=color:#e6db74>&#34;Your Route&#34;</span> should <span style=color:#e6db74>&#34;do something useful&#34;</span> in <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> directEndpoint <span style=color:#66d9ef>=</span> <span style=color:#e6db74>&#34;direct:testEndpoint&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> testRouteBuilder <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RouteBuilder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      from<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;timer:doesNotMatter&#34;</span><span style=color:#f92672>).</span>routeId<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;OurRoute&#34;</span><span style=color:#f92672>).</span>to<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;file:/some/path&#34;</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}.</span>builder
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> interceptor<span style=color:#f92672>(</span>context<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ModelCamelContext</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      context<span style=color:#f92672>.</span>getRouteDefinition<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;OurRoute&#34;</span><span style=color:#f92672>).</span>adviceWith<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AdviceWithRouteBuilder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> configure<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          replaceFromWith<span style=color:#f92672>(</span>directEndpoint<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    withCamelTestSupport<span style=color:#f92672>(</span>testRouteBuilder<span style=color:#f92672>,</span> interceptor<span style=color:#f92672>){</span> testSupport <span style=color:#66d9ef>=&gt;</span>
</span></span><span style=display:flex><span>        testSupport<span style=color:#f92672>.</span>template<span style=color:#f92672>.</span>sendBody<span style=color:#f92672>(</span>directEndpoint<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Some content&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//Assert files exists @ /some/path
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>With this style we get full flexibility about testing routes.</p></section><nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]"><a class="flex w-1/2 items-center p-6 pr-3 no-underline" href=http://siliconsenthil.in/blog/2013-07-11-apache-camel-with-scala-extending-dsl/><span class=mr-1.5>←</span><span>Apache Camel with Scala: Extending DSL</span></a>
<a class="ml-auto flex w-1/2 items-center justify-end p-6 pl-3 no-underline" href=http://siliconsenthil.in/blog/2013-03-26-integer-dot-parseint-god/><span>Integer.parseInt('God') = ???</span><span class=ml-1.5>→</span></a></nav></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2022
<a class=link href=http://siliconsenthil.in/>siliconsenthil</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>▷ Paper 6</a></footer></body></html>